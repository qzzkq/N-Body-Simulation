# N-body Simulation (CPU / Barnes–Hut / CUDA)

Интерактивный 3D-симулятор гравитационного **N-body** на **C++17** с визуализацией через **OpenGL**.

Проект умеет:
- загружать начальные условия из **HDF5** (`.h5`) или генерировать систему случайно;
- считать гравитацию алгоритмами **Brute Force (CPU)** / **Barnes–Hut (CPU)** / **Barnes–Hut (CUDA)** *(если собрано с CUDA)*;
- работать в **Real-time** (с ускорением/замедлением времени) или в режиме **Bake** (быстро просчитать до заданного времени);
- записывать траектории в `data/frames.h5` и воспроизводить их отдельной программой `replay`.

## Содержание
- [Сборка](#сборка)
- [Зависимости](#зависимости)
- [Запуск и сценарии](#запуск-и-сценарии)
- [Управление](#управление)
- [Формат HDF5 сценариев](#формат-hdf5-сценариев)
- [Запись симуляции и replay](#запись-симуляции-и-replay)
- [Алгоритмы](#алгоритмы)
- [Структура проекта](#структура-проекта)
- [Документация](#документация)

## Сборка

### Linux (Makefile)
```bash
cd project
make USE_CUDA=0      # CPU-only (если CUDA не установлена)
# или просто: make    # по умолчанию USE_CUDA=1
./nBodySim
#Воспроизведение записанной симуляции
cd project
make replay
./replay data/frames.h5
#Очистка 
make clean
```
### Windows (CMAKE)<br>
Рекомендуется работать в оболочке `MSYS2 MINGW`, скопировав папку репозитория в свою домашнюю директорию в оболочке - `path_to_msys\home\username`<br>
Вы можете установить все зависимости в `MSYS2` с помощью команду `pacman` (на официальном сайте `MSYS2` вы можете найти названия пакетов и инструкцию для установки)<br>
Когда все зависимости установлены, удостоверьтесь, что ваша оболочка содержит компилятор `g++` и систему сборки (`make` или, к примеру, `ninja`)<br>
Вы находитесь в репозитории, перейдите в папку `project` с помощью инструкции `cd project`<br>
```
cmake -S . -B build -DCMAKE_INSTALL_PREFIX=[укажите директорию, куда хотите установить собранное приложение]
cmake --build build 
cmake --install build # установит приложение в указанную вами папку
```

##Зависимости
#Обязательные

C++17 компилятор
OpenGL
GLFW, GLEW, GLM
HDF5 (C++ API)
CUDA(опционально)

## Запуск и сценарии
После запуска nBodySim программа задаёт вопросы в консоли:

Режим отрисовки: кубы/шары/точки [0/1/2]

Алгоритм:

[1] Brute Force (O(N²))

[2] Barnes–Hut CPU

[3] Barnes–Hut GPU (CUDA) (появится только если сборка с CUDA)

Сценарий: загрузить .h5 из data/ или сгенерировать случайно [0/1]

при загрузке — выбираете файл из списка data/*.h5

при генерации — вводите число тел

Режим работы: Real-time? [1] да / [0] нет (Bake)

в Bake-режиме дополнительно спрашивается, до какого времени (сек) считать

Во время работы симулятор пишет траектории в data/frames.h5 (файл перезаписывается при новом запуске).
## Управление 
| Клавиша/ввод   | Действие                      |
| -------------- | ----------------------------- |
| W / A / S / D  | движение камеры               |
| Space          | вверх                         |
| Left Shift     | вниз                          |
| Мышь           | поворот камеры                |
| Колёсико       | zoom (вперёд/назад)           |
| `=`            | ускорить время (timeScale ↑)  |
| `-`            | замедлить время (timeScale ↓) |
| K (удерживать) | пауза                         |
| Q              | выход                         |
| `[` / `]`      | уменьшить/увеличить окно      |

## Формат HDF5 сценариев
Входной файл .h5 должен содержать dataset Particles с записями:

position: double[3]

velocity: double[3]

mass: double

radius: double

Единицы (как принято в коде):

координаты — км

скорость — км/с

масса — кг (или масштабированная величина, если вы используете собственную систему единиц)

радиус — км (влияет на визуальный размер и на столкновения в brute-force)

В data/ лежат готовые примеры сценариев (например two_body_test.h5, solar_system.h5, solar_system_intruder.h5 и т.п.).
## Запись симуляции и replay
Симулятор создаёт data/frames.h5 со структурой:

атрибуты: num_bodies, dt (сек между кадрами), num_frames

initial_data: стартовые данные (позиция, масса, радиус)

tracks: позиции всех тел по кадрам (расширяемый датасет)

Плеер replay принимает путь к этому файлу:

```bash
./replay data/frames.h5
```
## Алгортимы
| Алгоритм    |        Где |  Сложность | Примечания                                                         |
| ----------- | ---------: | ---------: | ------------------------------------------------------------------ |
| Brute Force |        CPU |      O(N²) | есть простая обработка столкновений и ограничение расстояния снизу |
| Barnes–Hut  |        CPU | O(N log N) | октодерево, параметр θ фиксирован в коде                           |
| Barnes–Hut  | GPU (CUDA) | O(N log N) | доступен только при сборке с `USE_CUDA=1`                          |

## Структура проекта 
```
builds/          инструкции по сборке (linux/windows)
docs/            Vision, SRS, schedule, презентации
project/
  data/          входные сценарии (.h5) и выходной frames.h5
  include/       заголовки (.hpp)
  src/           исходники (.cpp/.cu)
  CMakeLists.txt
  Makefile
```
## Документация

Материалы проекта лежат в docs/
